<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Курс валют — Росинтер Ресторантс Холдинг</title>
  <link rel="stylesheet" href="main.css">
  <style>
    /* Калькулятор */
    #calculator {
      width: 800px;
      height: 200px;
      margin: 20px auto;
      border: 5px solid #ff8300;
      border-radius: 20px;
      display: flex;
      justify-content: center;
      align-items: center;
      position: relative;
      background-color: antiquewhite;
      font-weight: bold;
      box-sizing: border-box;
      padding: 10px;
    }
    #calculator input {
      width: 200px;
      margin-right: 10px;
      margin-left: -2px;
      border: 4px solid #ff8300;
      border-radius: 10px;
      border-top-left-radius: 0;
      border-bottom-left-radius: 0;
      height: 45px;
      font-size: 16px;
      box-sizing: border-box;
    }
    .cur {
      display: flex;
      align-items: center;
      border: 5px solid #ff8300;
      border-radius: 10px;
      border-top-right-radius: 0;
      border-bottom-right-radius: 0;
      width: 90px;
      height: 45px;
      background-color: #ff8300;
      padding: 0 5px;
      box-sizing: border-box;
    }
    #rate-today {
      position: absolute;
      bottom: 8px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 16px;
      text-align: center;
      width: 100%;
    }
    /* График */
    #chart {
      width: 1000px;
      margin: 40px auto;
      padding: 10px;
      box-sizing: border-box;
      border: 5px solid #ff8300;
      border-radius: 20px;
      background-color: antiquewhite;
    }
    #selected-info {
      text-align: center;
      margin-top: 10px;
      font-size: 16px;
      font-weight: bold;
    }
  </style>
  <!-- Chart.js библиотека -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <a id="top"></a>
  <header class="site-header">
    <div class="container header-inner">
      <a href="company.html" class="logo"><img src="logo_ru.svg" alt="Логотип"></a>
      <button id="hamburger" class="hamburger" aria-label="Меню">☰</button>
      <nav id="nav-menu" class="site-nav">
        <ul>
          <li><a href="company.html">О компании</a></li>
          <li><a href="news.html">Новости</a></li>
          <li><a href="currency.html" class="active">Курс валют</a></li>
          <li><a href="contact.html">Контакты</a></li>
          <li><a href="video.html">Видео</a></li>
        </ul>
      </nav>
    </div>
  </header>
  <main class="container main-content">
    <h1 style="text-align:center;">Курс Cингапурского доллара</h1>
    <div id="calculator">
      <div class="cur">
        <img src="RUB.png" height="40" style="margin-left: -5px;">
        <span style="font-size:20px; margin-left:3px;">RUB</span>
      </div>
      <input type="number" id="rubInput" placeholder="Сумма в рублях">
      <div class="cur">
        <img src="SGD.png" height="33" alt="SGD">
        <span style="font-size:20px; margin-left:5px;">SGD</span>
      </div>
      <input type="number" id="curInput" placeholder="Сумма в SGD">
      <p id="rate-today"></p>
    </div>
    <div id="chart">
      <canvas id="rateChart" width="800" height="300"></canvas>
      <p id="selected-info"></p>
    </div>
  </main>
  <a href="#top" class="to-top"><span class="to-top__text">▲</span></a>
  <footer class="site-footer">
    <div class="container footer-inner">
      <p>&copy; 2025 «Росинтер Ресторантс Холдинг»</p>
    </div>
  </footer>
  <script>
    async function loadRates() {
      // Получаем текущий курс
      const resp = await fetch('https://www.cbr-xml-daily.ru/daily_json.js');
      const data = await resp.json();
      const sgd = data.Valute.SGD;
      const nominal = sgd.Nominal;
      const value = sgd.Value;
      const todayRate = (value/nominal).toFixed(4);
      document.getElementById('rate-today').textContent =
        `Курс SGD на сегодня: 1 SGD = ${todayRate} RUB`;
      // Конвертер
      const rubIn = document.getElementById('rubInput');
      const sgdIn = document.getElementById('curInput');
      function rubToSgd(r) { return r*(nominal/value); }
      function sgdToRub(s) { return s*(value/nominal); }
      rubIn.addEventListener('input', ()=>{
        sgdIn.value = (rubToSgd(parseFloat(rubIn.value)||0)).toFixed(4);
      });
      sgdIn.addEventListener('input', ()=>{
        rubIn.value = (sgdToRub(parseFloat(sgdIn.value)||0)).toFixed(2);
      });
      // История последних 30 дней
      let rates=[];
      let curData = data;
      for(let i=0;i<30;i++){
        rates.push({date:new Date(curData.Date).toLocaleDateString('ru-RU'),
                    rate: curData.Valute.SGD.Value/curData.Valute.SGD.Nominal});
        if(!curData.PreviousURL) break;
        const url = curData.PreviousURL.startsWith('//') ? 'https:'+curData.PreviousURL : curData.PreviousURL;
        const pr = await fetch(url);
        if(!pr.ok) break;
        curData = await pr.json();
      }
      rates.reverse();
      const labels = rates.map(r=>r.date);
      const vals = rates.map(r=>+r.rate.toFixed(4));
      // Chart.js
      const ctx = document.getElementById('rateChart').getContext('2d');
      const chart = new Chart(ctx, {
        type: 'bar',
        data: {
          labels,
          datasets: [{
            label: 'SGD → RUB',
            data: vals,
            backgroundColor: 'white',
            borderColor: '#ff8300',
            borderWidth: 3,
            borderRadius: 5,
            borderSkipped: 'bottom'
          }]
        },
        options: {
          onClick: (evt, elems) => {
            if(elems.length){
              const idx = elems[0].index;
              const bg = labels.map((_,i)=> i===idx ? '#ff8300' : 'white');
              const br = labels.map((_,i)=> i===idx ? '#ff8300' : '#ff8300');
              chart.data.datasets[0].backgroundColor = bg;
              chart.data.datasets[0].borderColor = br;
              chart.data.datasets[0].borderWidth = labels.map((_,i)=> i===idx ? 3 : 3);
              chart.update();
              document.getElementById('selected-info').textContent =
                `Дата: ${rates[idx].date}, курс: ${rates[idx].rate.toFixed(4)} RUB`;
            }
          },
          scales: { y: { beginAtZero: false } }
        }
      });
    }
    window.onload = loadRates;

    const hamburger = document.getElementById('hamburger');
    const navMenu = document.getElementById('nav-menu');
    hamburger.addEventListener('click', () => navMenu.classList.toggle('open'));
  </script>
</body>
</html>
